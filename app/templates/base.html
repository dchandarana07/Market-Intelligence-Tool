<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Market Intelligence{% endblock %}</title>
    <script>
        (function() {
            const storageKey = 'mi-theme';
            let saved = null;
            try {
                saved = localStorage.getItem(storageKey);
            } catch (err) {
                saved = null;
            }
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            document.documentElement.dataset.theme = theme;
        })();
    </script>
    <link rel="stylesheet" href="/static/css/custom.css?v=5">
    {% block extra_css %}{% endblock %}
</head>
<body class="app-shell">
    <div class="background-grid"></div>

    <header class="app-nav">
        <div class="container nav-inner">
            <a href="/" class="brand-block">
                <div class="brand-logo">LI</div>
                <div class="brand-text-stack">
                    <span class="brand-line-1">Learning Innovations</span>
                    <span class="brand-line-2">Market Research Console</span>
                </div>
            </a>

            <div class="nav-user">
                <button type="button" id="themeToggle" class="btn btn-ghost mode-btn" aria-label="Switch to light mode">
                    Light Mode
                </button>

                {% if user %}
                <div class="user-pill">
                    {% if user.picture %}
                    <img src="{{ user.picture }}" alt="{{ user.name }}" class="avatar">
                    {% else %}
                    <div class="avatar">{{ user.name[0] if user and user.name else 'U' }}</div>
                    {% endif %}
                    <div class="user-meta">
                        <strong>{{ user.name }}</strong>
                        <span>{{ user.email }}</span>
                    </div>
                </div>
                <a href="/auth/logout" class="btn btn-ghost">Sign Out</a>
                {% else %}
                <div class="pill">Secure Workspace</div>
                {% endif %}
            </div>
        </div>
    </header>

    {% block progress %}{% endblock %}

    <main class="app-main">
        <div class="container content-wrap">
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer>
        <div class="container footer-inner" style="justify-content: center; text-align: center;">
            <div>© 2025 Market Intelligence · Learning Enterprise · Arizona State University</div>
        </div>
    </footer>

    <script>
        (function() {
            const root = document.documentElement;
            const toggle = document.getElementById('themeToggle');
            if (!toggle) return;
            const storageKey = 'mi-theme';

            const storeTheme = (theme) => {
                try {
                    localStorage.setItem(storageKey, theme);
                } catch (err) {}
            };

            const updateButton = () => {
                const current = root.dataset.theme || 'dark';
                const label = current === 'dark' ? 'Light Mode' : 'Dark Mode';
                toggle.textContent = label;
                toggle.setAttribute('aria-label', `Switch to ${label.toLowerCase()}`);
            };

            updateButton();

            toggle.addEventListener('click', () => {
                const next = root.dataset.theme === 'dark' ? 'light' : 'dark';
                root.dataset.theme = next;
                storeTheme(next);
                updateButton();
            });
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
