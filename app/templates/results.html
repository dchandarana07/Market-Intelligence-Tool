{% extends "base.html" %}

{% block title %}Results Â· Market Intelligence{% endblock %}

{% block content %}
<div class="page-header">
    <span class="eyebrow">Delivery ready</span>
    <h1>Analysis complete</h1>
    <p class="hero-lede">{{ run_info.session.topic }}</p>
</div>

<div class="panel results-card">
    <div class="icon-ring">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#22d3ee" stroke-width="2">
            <path d="M5 13l4 4L19 7"></path>
        </svg>
    </div>
    <h2>Outputs shipped</h2>
    <p class="input-hint">All modules completed and synced to Google Workspace.</p>
    {% if run_info.output_url %}
    <a href="{{ run_info.output_url }}" target="_blank" class="btn btn-primary" style="margin-top:20px;">
        Open spreadsheet
    </a>
    {% endif %}
    {% if run_info.output_folder_url %}
    <p class="input-hint" style="margin-top:14px;">
        <a href="{{ run_info.output_folder_url }}" target="_blank" class="link-soft">Open Drive folder</a>
    </p>
    {% endif %}
</div>

{% if run_info.result and run_info.result.progress %}
<div class="panel" style="margin-top:32px;">
    <h2 style="margin-top:0;">Module performance</h2>
    <div class="result-list" style="margin-top:20px;">
        {% for module_name, progress in run_info.result.progress.items() %}
        <div class="result-item {% if progress.status.value == 'completed' %}completed{% elif progress.status.value == 'partial' %}partial{% else %}failed{% endif %}">
            <div>
                <strong>{{ progress.display_name }}</strong>
                {% if progress.result and progress.result.total_rows %}
                <div class="input-hint">{{ progress.result.total_rows }} rows generated</div>
                {% endif %}
            </div>
            <span class="pill {% if progress.status.value == 'completed' %}success{% elif progress.status.value == 'partial' %}warning{% else %}danger{% endif %}">
                {{ progress.status.value | title }}
            </span>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="callout" style="margin-top:32px;">
    A link to these results has been emailed to <strong>{{ run_info.session.email }}</strong>. Files stay in sync even if you rerun this workflow later.
</div>

<div class="actions" style="justify-content:center;">
    <a href="/" class="btn btn-primary">Launch another analysis</a>
</div>
{% endblock %}
